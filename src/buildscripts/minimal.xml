<project name="bmminimal" xmlns:ivy="antlib:org.apache.ivy.ant" xmlns:c="antlib:net.sf.antcontrib">
    <target name="clean-build" extensionOf="clean">
        <delete dir="${build.dir}"/>
    </target>

    <target name="clean-deps">
        <delete dir="${deps.dir}"/>
    </target>

    <target name="deflibspath">
        <path id="cp.ivy" location="/usr/share/java/ivy.jar"/>
        <path id="cp.httpclient" location="/usr/share/java/commons-httpclient.jar"/>
        <path id="cp.clogging" location="/usr/share/java/commons-logging.jar"/>
        <path id="cp.ccodec" location="/usr/share/java/commons-codec.jar"/>
        <path id="cp.cio" location="/usr/share/java/commons-io.jar"/>
        <path id="cp.ccompress" location="/usr/share/java/commons-compress.jar"/>
        <path id="cp.antcontrib" location="/usr/share/java/ant-contrib.jar"/>
        <path id="cp.jsch" location="/usr/share/java/jsch.jar"/>
    </target>

    <target name="load-baseantlibs">
        <taskdef resource="net/sf/antcontrib/antlib.xml" uri="antlib:net.sf.antcontrib" classpathref="cp.antcontrib"/>
        <taskdef resource="com/kloudtek/buildmagic/antlib.xml" uri="antlib:com.kloudtek.buildmagic">
            <classpath>
                <path location="${bmminimal.basedir}/buildmagic.jar"/>
                <path refid="cp.cio"/>
                <path refid="cp.ccompress"/>
            </classpath>
        </taskdef>
    </target>

    <target name="load-ivy" depends="deflibspath,load-baseantlibs">
        <taskdef resource="org/apache/ivy/ant/antlib.xml" uri="antlib:org.apache.ivy.ant">
            <classpath>
                <path refid="cp.ivy"/>
                <path refid="cp.httpclient"/>
                <path refid="cp.clogging"/>
                <path refid="cp.ccodec"/>
                <path refid="cp.jsch"/>
            </classpath>
        </taskdef>
    </target>

    <target name="init-ivy" depends="load-ivy,load-baseantlibs">
        <c:if>
            <available file="${user.home}/.bm.ivysettings.xml"/>
            <then>
                <echo>Loading Ivy Settings file: ${user.home}/.bm.ivysettings.xml</echo>
                <ivy:settings file="${user.home}/.bm.ivysettings.xml"/>
            </then>
            <else>
                <ivy:settings/>
            </else>
        </c:if>
    </target>

    <target name="deps" depends="defaultproperties,init-ivy">
        <ivy:retrieve pattern="${deps.dir}/[conf]-[type]/[artifact].[ext]" symlink="true"/>
    </target>

    <target name="publish-ivy" depends="init-ivy,tests,artifacts">
        <fail unless='version'/>
        <fail unless='reltype'/>
        <property name="publishresolver" value="default"/>
        <ivy:publish resolver="${publishresolver}" pubrevision="${version}" status="${reltype}"
                     artifactspattern="${build.dir}/artifacts/[artifact].[ext]" update="true"/>
    </target>

    <extension-point name="clean"/>

    <extension-point name="compile"/>

    <extension-point name="artifacts" depends="compile"/>
</project>